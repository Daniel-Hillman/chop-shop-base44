import{R as e}from"./waveform-core-ygTHjRxL.js";const t={},r=function(e,r,n){let a=Promise.resolve();if(r&&r.length>0){let e=function(e){return Promise.all(e.map(e=>Promise.resolve(e).then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e}))))};document.getElementsByTagName("link");const n=document.querySelector("meta[property=csp-nonce]"),i=n?.nonce||n?.getAttribute("nonce");a=e(r.map(e=>{if((e=function(e){return"/"+e}(e))in t)return;t[e]=!0;const r=e.endsWith(".css"),n=r?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${n}`))return;const a=document.createElement("link");return a.rel=r?"stylesheet":"modulepreload",r||(a.as="script"),a.crossOrigin="",a.href=e,i&&a.setAttribute("nonce",i),document.head.appendChild(a),r?new Promise((t,r)=>{a.addEventListener("load",t),a.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function i(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return a.then(t=>{for(const e of t||[])"rejected"===e.status&&i(e.reason);return e().catch(i)})},n={waveformVisualization:{enabled:!0,rolloutPercentage:100,description:"Basic waveform visualization"},webAudioAnalysis:{enabled:!0,rolloutPercentage:90,description:"Web Audio API based analysis",requirements:["webAudioSupport"]},videoFrameAnalysis:{enabled:!0,rolloutPercentage:80,description:"Video frame based audio analysis fallback",requirements:["canvasSupport"]},dragChopCreation:{enabled:!0,rolloutPercentage:95,description:"Drag-based chop creation and editing"},zeroCrossingDetection:{enabled:!0,rolloutPercentage:70,description:"Zero-crossing detection for clean cuts",requirements:["webAudioSupport"]},smartSnapping:{enabled:!0,rolloutPercentage:75,description:"Smart snapping to optimal cut points",requirements:["zeroCrossingDetection"]},visualEnhancements:{enabled:!0,rolloutPercentage:60,description:"Advanced visual enhancements and color coding",requirements:["highPerformanceDevice"]},frequencyAnalysis:{enabled:!1,rolloutPercentage:30,description:"Real-time frequency analysis visualization",requirements:["webAudioSupport","highPerformanceDevice"]},webWorkerAnalysis:{enabled:!0,rolloutPercentage:85,description:"Background audio analysis using Web Workers",requirements:["webWorkerSupport"]},offscreenCanvas:{enabled:!0,rolloutPercentage:50,description:"Offscreen canvas rendering for better performance",requirements:["offscreenCanvasSupport"]},audioWorkletAnalysis:{enabled:!1,rolloutPercentage:10,description:"AudioWorklet-based real-time analysis",requirements:["audioWorkletSupport","experimentalFeatures"]},aiPoweredChopSuggestions:{enabled:!1,rolloutPercentage:5,description:"AI-powered chop suggestions based on musical structure",requirements:["experimentalFeatures","highPerformanceDevice"]},performanceMonitoring:{enabled:!0,rolloutPercentage:100,description:"Performance monitoring and analytics"},debugVisualization:{enabled:!1,rolloutPercentage:100,description:"Debug visualization overlays"}};const a=new class{constructor(){this.flags={...n},this.userSegment=this._determineUserSegment(),this.deviceCapabilities=this._detectDeviceCapabilities(),this.overrides=this._loadOverrides(),this._applyOverrides()}isEnabled(e){const t=this.flags[e];return!!t&&(!!t.enabled&&(!(t.requirements&&!this._checkRequirements(t.requirements))&&!!this._isInRollout(e,t.rolloutPercentage)))}getEnabledFeatures(){return Object.keys(this.flags).filter(e=>this.isEnabled(e))}getFeatureDetails(e){const t=this.flags[e];return t?{...t,isEnabled:this.isEnabled(e),requirementsMet:!t.requirements||this._checkRequirements(t.requirements),inRollout:this._isInRollout(e,t.rolloutPercentage)}:null}override(e,t){this.flags[e]&&(this.overrides[e]=t,this._saveOverrides())}clearOverrides(){this.overrides={},this._saveOverrides()}getSummary(){const e=this.getEnabledFeatures(),t=Object.keys(this.flags).length;return{userSegment:this.userSegment,deviceCapabilities:this.deviceCapabilities,enabledFeatures:e,totalFeatures:t,enabledCount:e.length,overrides:this.overrides,flagDetails:Object.fromEntries(Object.keys(this.flags).map(e=>[e,this.getFeatureDetails(e)]))}}_determineUserSegment(){const e=this._getUserId(),t=this._hashString(e)%100;return t<10?"early_adopters":t<30?"beta_users":t<80?"regular_users":"conservative_users"}_detectDeviceCapabilities(){return{webAudioSupport:"AudioContext"in window||"webkitAudioContext"in window,webWorkerSupport:"Worker"in window,offscreenCanvasSupport:"OffscreenCanvas"in window,audioWorkletSupport:"AudioWorklet"in window,canvasSupport:"HTMLCanvasElement"in window,highPerformanceDevice:this._isHighPerformanceDevice(),experimentalFeatures:this._allowExperimentalFeatures()}}_isHighPerformanceDevice(){const e=navigator.hardwareConcurrency||2,t=navigator.deviceMemory||2,r=/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);return e>=4&&t>=4&&!r}_allowExperimentalFeatures(){return"early_adopters"===this.userSegment||"true"===localStorage.getItem("waveform_experimental_features")}_checkRequirements(e){return e.every(e=>e in this.deviceCapabilities?this.deviceCapabilities[e]:e in this.flags&&this.isEnabled(e))}_isInRollout(e,t){if(t>=100)return!0;if(t<=0)return!1;const r=this._getUserId();return this._hashString(`${r}_${e}`)%100<t}_getUserId(){let e=localStorage.getItem("waveform_user_id");return e||(e=`user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,localStorage.setItem("waveform_user_id",e)),e}_hashString(e){let t=0;for(let r=0;r<e.length;r++){t=(t<<5)-t+e.charCodeAt(r),t&=t}return Math.abs(t)}_loadOverrides(){try{const e=localStorage.getItem("waveform_feature_overrides");return e?JSON.parse(e):{}}catch(e){return{}}}_saveOverrides(){try{localStorage.setItem("waveform_feature_overrides",JSON.stringify(this.overrides))}catch(e){}}_applyOverrides(){for(const[e,t]of Object.entries(this.overrides))this.flags[e]&&(this.flags[e].enabled=t)}},i=t=>{const[r,n]=e.useState(a.isEnabled(t));return e.useEffect(()=>{const e=()=>{n(a.isEnabled(t))};return window.addEventListener("storage",e),()=>{window.removeEventListener("storage",e)}},[t]),r};const s=new class{constructor(){this.sessionId=this._generateSessionId(),this.events=[],this.performanceMetrics=new Map,this.userBehaviorPatterns=new Map,this.isEnabled=this._checkAnalyticsConsent()}trackEvent(e,t={}){if(!this.isEnabled)return;const r={sessionId:this.sessionId,timestamp:Date.now(),type:e,data:{...t,userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight}}};this.events.push(r),this._processEvent(r),this.events.length>=10&&this._flushEvents()}trackPerformance(e,t,r={}){if(!this.isEnabled)return;const n={name:e,value:t,timestamp:Date.now(),sessionId:this.sessionId,metadata:r};this.performanceMetrics.has(e)||this.performanceMetrics.set(e,[]),this.performanceMetrics.get(e).push(n),this._analyzePerformanceTrend(e,t)}trackWaveformGeneration(e,t,r,n){this.trackEvent("waveform_generation",{analysisMethod:e,generationTime:t,audioLength:r,quality:n,efficiency:r/t}),this.trackPerformance("waveform_generation_time",t,{analysisMethod:e,audioLength:r,quality:n})}trackInteraction(e,t={}){this.trackEvent("waveform_interaction",{interactionType:e,...t});const r=`interaction_${e}`,n=this.userBehaviorPatterns.get(r)||0;this.userBehaviorPatterns.set(r,n+1)}trackChopActivity(e,t={}){this.trackEvent("chop_activity",{activity:e,chopDuration:t.duration,chopPosition:t.startTime,creationMethod:t.creationMethod,snapUsed:t.snapUsed||!1})}trackNavigation(e,t,r){this.trackEvent("waveform_navigation",{action:e,zoomLevel:t,timeRange:{start:r.start,end:r.end,duration:r.end-r.start}})}trackError(e,t,r={}){this.trackEvent("waveform_error",{errorType:e,errorMessage:t,context:r,recoveryAttempted:r.recoveryAttempted||!1,recoverySuccessful:r.recoverySuccessful||!1})}trackFeatureUsage(e,t={}){this.trackEvent("feature_usage",{featureName:e,...t});const r=`feature_${e}`,n=this.userBehaviorPatterns.get(r)||0;this.userBehaviorPatterns.set(r,n+1)}getAnalyticsSummary(){return{sessionId:this.sessionId,totalEvents:this.events.length,performanceMetrics:Object.fromEntries(Array.from(this.performanceMetrics.entries()).map(([e,t])=>[e,{count:t.length,average:t.reduce((e,t)=>e+t.value,0)/t.length,latest:t[t.length-1]?.value}])),userBehaviorPatterns:Object.fromEntries(this.userBehaviorPatterns),topInteractions:this._getTopInteractions(),performanceTrends:this._getPerformanceTrends()}}exportAnalyticsData(){return this.isEnabled?{sessionId:this.sessionId,events:this.events,performanceMetrics:Object.fromEntries(this.performanceMetrics),userBehaviorPatterns:Object.fromEntries(this.userBehaviorPatterns),exportedAt:Date.now()}:null}_generateSessionId(){return`waveform_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}_checkAnalyticsConsent(){return"true"===localStorage.getItem("waveform_analytics_consent")}_processEvent(e){switch(e.type){case"waveform_generation":this._analyzeGenerationPerformance(e.data);break;case"waveform_interaction":this._analyzeInteractionPattern(e.data);break;case"waveform_error":this._analyzeErrorPattern(e.data)}}_analyzeGenerationPerformance(e){const t=this.events.filter(e=>"waveform_generation"===e.type).slice(-5);if(t.length>=3){t.reduce((e,t)=>e+t.data.generationTime,0),t.length}}_analyzeInteractionPattern(e){const t=e.interactionType,r=this.events.filter(e=>"waveform_interaction"===e.type&&e.data.interactionType===t).slice(-10);if(r.length>=5){const e=r[r.length-1].timestamp-r[0].timestamp;r.length}}_analyzeErrorPattern(e){const t=e.errorType;this.events.filter(e=>"waveform_error"===e.type&&e.data.errorType===t).slice(-5).length}_analyzePerformanceTrend(e,t){const r=this.performanceMetrics.get(e)||[];if(r.length>=5){const e=r.slice(-5),t=e[e.length-1].value-e[0].value;Math.abs(t)}}_getTopInteractions(){return Array.from(this.userBehaviorPatterns.entries()).filter(([e])=>e.startsWith("interaction_")).sort(([,e],[,t])=>t-e).slice(0,5).map(([e,t])=>({interaction:e.replace("interaction_",""),count:t}))}_getPerformanceTrends(){const e={};for(const[t,r]of this.performanceMetrics.entries())if(r.length>=3){const n=r.slice(-3),a=n[n.length-1].value-n[0].value;e[t]={trend:a>0?"increasing":"decreasing",magnitude:Math.abs(a),latest:n[n.length-1].value}}return e}_flushEvents(){this.events=[]}},o=()=>({trackEvent:s.trackEvent.bind(s),trackPerformance:s.trackPerformance.bind(s),trackInteraction:s.trackInteraction.bind(s),trackChopActivity:s.trackChopActivity.bind(s),trackNavigation:s.trackNavigation.bind(s),trackError:s.trackError.bind(s),trackFeatureUsage:s.trackFeatureUsage.bind(s),getSummary:s.getAnalyticsSummary.bind(s)});export{r as _,o as a,i as u,a as w};
